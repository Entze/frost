#!/usr/bin/env bash
#MISE description="Copy release notes from RELEASE.txt to CHANGELOG.md"
set -euo pipefail

# Extract lines 2+ from RELEASE.txt
tail -n +2 RELEASE.txt > /tmp/release_notes.txt

# Find the line number of the first ## heading in CHANGELOG.md
line_num=$(grep -n "^## " CHANGELOG.md | head -n 1 | cut -d: -f1 || true)

# Insert release notes after that line
if [ -n "$line_num" ]; then
  head -n "$line_num" CHANGELOG.md > /tmp/changelog_head.txt
  echo "" >> /tmp/changelog_head.txt
  cat /tmp/release_notes.txt >> /tmp/changelog_head.txt
  tail -n +"$((line_num + 1))" CHANGELOG.md >> /tmp/changelog_head.txt
  mv /tmp/changelog_head.txt CHANGELOG.md
fi

rm -f /tmp/release_notes.txt
