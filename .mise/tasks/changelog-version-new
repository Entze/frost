#!/usr/bin/env bash
#MISE description="Insert new version header with current date into CHANGELOG.md"
set -euo pipefail

version=$(bump-my-version show current_version)
date=$(date +%Y-%m-%d)
header="## $version ($date)"

# Insert new version header after "# Changelog" line
awk -v header="$header" '/^# Changelog/ {print; print ""; print header; next} 1' CHANGELOG.md > CHANGELOG.md.tmp
mv CHANGELOG.md.tmp CHANGELOG.md
